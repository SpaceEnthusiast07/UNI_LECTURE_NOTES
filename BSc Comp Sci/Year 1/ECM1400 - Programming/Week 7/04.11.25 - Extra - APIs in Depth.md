In this note I am trying to understand the structure of APIs and how to use them in Python.


##### Contents
 - [[#Structure of an API URL]]
 - [[#Getting and Using an API Key]]
 - 


##### Structure of an API URL
 - An ***API URL***, also known as an *endpoint*, is a specific address that the program sends the requests to.
 - Broken down URL:
	 - `https://` - The *protocol*, almost always *HTTPS* for security
	 - `api.openweathermap.org` - The *domain name*, the API provider's server
	 - `/data/2.5/weather` - The *endpoint path*, tells the API what kind of data you want (e.g. weather info)
	 - `?` - Marks the start of the *query string*, list of *parameters*
	 - `q=Exeter` - A *query parameter*, here the city name
	 - `&` - Separates multiple parameters
	 - `appid=<API_KEY>` - Another parameter, the API for authentication
 - You will receive the URL structure from the API documentation of the provider (e.g. OpenWeatherMap, NewsAPI, Spotify, etc)
 - The documentation will always show:
	 - The *base URL*
	 - Available *endpoints*
	 - Required *parameters*
	 - The *response format*, usually JSON


##### Getting and Using an API Key
 - An ***API Key*** is a unique identifier (like a password) that lets the provider know who is accessing their data
 - How to get an API Key:
	 1. Go to the providers website, e.g. https://openweathermap.org/api
	 2. Sign up for an account
	 3. Generate you personal API key in your account dashboard
 - How to use the key:
	 - You include it in your request so the server knows it's you
	 - As a *query parameter*, common for simple APIs
		 - E.g. `url = "https://api.openweathermap.org/data/2.5/weather?q=Exeter&appid=7e07fba5693c47c2a150739c4d58d177"`
	 - In the *headers*, common for secure APIs

>[!warning] Never store API Keys in scripts - store them in a `.env` or `api-key.json` file


##### API Headers
 - Headers are *metadata* sent along with your request
 - They describe *how* to interpret the data or authenticate you

| Header          | Purpose                                                  | Example                              |
| --------------- | -------------------------------------------------------- | ------------------------------------ |
| `Authorisation` | Proves your identity or access rights                    | `"Authorisation": "Bearer <API_KEY>` |
| `Content-Type`  | Tells the server what format you are sending the data in | `"Content-Type": "application/json"` |
| `Accept`        | Tells the server what kind of response you want          | `"Accept": "application/json"`       |
| `User-Agent`    | Identifies your app or script                            | `"User-Agent": "MyWeatherApp/1.0"`   |
 - Example in Python:
```python
# Import the module allowing you to use APIs
import requests

# Define the URL
url = "https://api.example.com/data"

# Define the headers
headers = {
    "Authorization": "Bearer YOUR_API_KEY",
    "Content-Type": "application/json",
    "Accept": "application/json"
}

# Send the request
response = requests.get(url, headers=headers)

# Output the status code of the response
print(response.status_code)

# Output the contents of the response
print(response.json())
```


##### HTTP Methods
 - ***HTTP methods*** (also called *verbs*) tell the server *what kind of action* you want to perform

| Method     | Meaning               | Example                          | Use case                          |
| ---------- | --------------------- | -------------------------------- | --------------------------------- |
| **GET**    | Retrieve data         | `requests.get(url)`              | Fetch weather info, user profiles |
| **POST**   | Send new data         | `requests.post(url, json=data)`  | Submit a form, upload data        |
| **PUT**    | Update existing data  | `requests.put(url, json=data)`   | Edit a record                     |
| **DELETE** | Remove data           | `requests.delete(url)`           | Delete a resource                 |
| **PATCH**  | Partially update data | `requests.patch(url, json=data)` | Update a few fields               |


##### Example 1 - GET Request
 - Fetch data from a weather API:
```python
import requests

url = "https://api.openweathermap.org/data/2.5/weather"
params = {
    "q": "Exeter",
    "appid": "YOUR_API_KEY",
    "units": "metric"
}

response = requests.get(url, params=params)
print(response.status_code)  # 200 means OK
print(response.json())       # Prints weather data as a dictionary
```


##### Example 2 - POST Request
 - Send data to the server:
```python
import requests

url = "https://api.example.com/users"
headers = {"Content-Type": "application/json"}
data = {"name": "Cameron", "email": "cam@example.com"}

response = requests.post(url, json=data, headers=headers)
print(response.status_code)
print(response.json())
```


##### Handling Responses
 - Every API response has:
	 - A status code
	 - A response body (usually JSON)
	 - Possibly headers
 - Example Python code:
```python
# Checking the response was OK
if response.status_code == 200:
	# Outputing the data int he response
    data = response.json()
    print("Temperature:", data["main"]["temp"])
else:
	# Inform the user of which error occured
    print("Error:", response.status_code)
```


##### The Request-Response Lifecycle
 - This is what happens when your program calls an API:
	 1. Your program (client) builds a request:
		 - URL + endpoint
		 - Headers
		 - Body (optional)
	 2. The API server receives the request, processes it
	 3. The server responds with:
		 - Status code (e.g. 200, 404, 500)
		 - Response body (often JSON)
	 4. Your program parses the response and uses the data


##### Full Example (Weather API)
 - Full python example
```python
# Import the requests module so you can use APIs
import requests

# Load in your API Key, usually within an external file
api_key = "YOUR_API_KEY"

# Aks the user which city they want the weather for
city = input("Enter city: ")

# Create the API URL
url = "https://api.openweathermap.org/data/2.5/weather"

# Specify the parameters separately
params = {"q": city, "appid": api_key, "units": "metric"}

# Send the request
response = requests.get(url, params=params)

# Check if the request was OK
if response.status_code == 200:
	# Extract the response data
    data = response.json()
    
    # Output the data
    print(f"City: {data['name']}")
    print(f"Temperature: {data['main']['temp']}Â°C")
    print(f"Weather: {data['weather'][0]['description']}")
else:
	# If something went wrong, inform the user
    print("Error:", response.status_code)
```








